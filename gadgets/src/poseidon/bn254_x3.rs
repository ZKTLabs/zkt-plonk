use alloc::rc::Rc;
use ark_bn254::Fr;
use plonk_hashing::hasher::{
    FieldHasherGenerator, NativePlonkSpecRef, PlonkSpecRef, PoseidonConstants, PoseidonRef,
};

use crate::poseidon::{parse_matrix, parse_vec};

const FULL_ROUNDS: usize = 8;
const PARTIAL_ROUNDS: usize = 55;
const WIDTH: usize = 3;

const ROUND_CONSTANTS: &[&str] = &[
    "1051ABD795BB781C5BCB3D4C7320B88F033CB1904C5B8559BF08995BE4D6305D",
    "2680C4E5E102394A8C53C7CA99003CBEB3422CAEDBFA62C2373862E367A3DD00",
    "132E8252BA372E32578A441CA6B0865F73D890C968DD8B7642F5B483676160B6",
    "0DFF6973DF3B1F559D2E21EDE06B857C63E4DA1BD50A03E4D500E226DD108BE7",
    "05E9463E0290D75EB2948587B1F9A7CA52EA91C9E57B322CDFAB3C4822F1ABBD",
    "2365C6A8B9928E31609CB8190336A6A2EEBF69B015BC7958840576FD4E42DA38",
    "16AA8BA01611F750811CBB3D4257F53A969FCCAEC3130B7A6441C39C9BAE8458",
    "2717B1A58BF1978C6AF4069069429E64EA024EFD3B9BE8FE8AA2BF1D8C28F42D",
    "2D26BD604C702D7C74850099492EFB38BC836C3CB88602E1679DDB53557292BF",
    "174A4DE6C44CAB3C9781597FA27C024F7C7A114632A541ED7FED2DEB245A85E1",
    "1D3E5ECBB083875C59541464DC6E7D1A59B4F68D985A213B28314A3004EC6809",
    "014EDB6E589987B69E282DB5F52C1B0BBE8704E601154C6A0AFE84B52F9A4AAE",
    "0E0D8D1E063D74B601A548EAE7D368FD8AC907DD9145BEAF63F2E2A6A28FCCD5",
    "0602AE8FFB9D13F3CCE1E3AE3C2F494B03D3FC2FC6426D5FE6CC1C312D068DA2",
    "23868F037D108E9346A8D63130D6D9AAB87E701C1828C574FA67CC8C1177A6B3",
    "1073B5A9CE850E2D6F16E5776B4EE254146ED65BBD8F50D36E17747778AF00D2",
    "073DA226B5A2639FE26496CDC3DBD5FD769984DC39E44003781D9140596543C4",
    "2CFBFACAAAB3B3526FD0DC6D369646F3FE3948DA0FA8A132F0DBDE96B5DDC9E6",
    "0FC0855A69B277B726AC164B86FFBA19954C0D59802838C4F032DF5CA38AE88E",
    "2649F096F1E407ADBE09B44A07C54EC03F23CDEF4B1E4C96D81F632DF917E0E0",
    "0F9C0AA8C10F48A205C7ED49D1CFFA12829B53AC76840F3A0AFF6CB10418CA40",
    "11547A7F704F1EB0394663D4AFC2FE19823910BEBE3147B6F0FFB7F8433838E1",
    "16AFF7C7076D3487C8D10E640DA7652A5F3A007967EAA7282CED25E89B61787D",
    "011A06492822359DBD9406C3AFBA3BFA469147F483F0AE78C80F9077DE480B86",
    "0D7F084FE4F168DD3B06A36866399B1C4C3C6A7F247F317D8463D9E447608134",
    "078B6029F46DC32407770079FF46C9B20ACCEA7CD0120EF5FDCA18A7CB65B127",
    "2DEA4E22DE864B493684AEBB0A692F939CE841AEBF83330C13F2EE57071793AE",
    "08CBCBA0C91B3981C0207F75E4B0F032FEAF5480E4AA243C946D938A2A57645F",
    "02D8F99EA79DBDE1025EA741C56C3E6978E7EB7B820EB30148D6C059BB8C365E",
    "109B2D0BCDBD121D2764BEEEC0284A1B13CDB171AB316E729F6980ADB7E219A3",
    "06A25826DC6271BF8C924962DA4CDA44DC320D0C66F31FD2EFEF0BD9B9F8FE35",
    "1A63E4E11C99ECBB52B14E202FD651A9872E560E9403FA2D9F33D20BCC32BCA4",
    "03FB5DEB4CDADF1CE955FA3C091F2DFB8C58951760769D1484F06CCF3A687D5B",
    "0BDAC171754F43976C5CAFD607771B9C7704E9D1C5576B87FE2AA0D80AB0FE01",
    "253A502BCFB721C80A2774434713EF20FAD993DC5751C0673F44EF976D5CE751",
    "0E21300AEC534829255ADD130D31DA0DC54282656E893CBA45B81B123671C2C5",
    "0D9D748361F6BBB3782751508FD274913D9153EFF951DBA21F3B20E69F229A36",
    "1EAFE91D860AD0794059D7ABE25FFA38D1E0229F64F81D34EEFFADB1575EDFC8",
    "1208792AF32377CD04BF0B77947EF589D4069B8743BC8B4878D09DAA669B6B9B",
    "0C8593F0FD900EBA22C520ADCA2FAC43EF1E22676C396804A421CB9B10EC78A4",
    "1BD21887FF52EF7FC2535B98DC27CF269BAA0905B006BC8C347518DA237C0EBA",
    "1F286D70C425A4F9C587777C055274940A860DEF2EE096DD382B3098B526A211",
    "12F295CBA6747661E15782C98DFC37986FF39910B5ADE0AF270359A0240AC15C",
    "27B574790203BDE222F06EC565EEB97B5CB638D48B91D696406AD922C5CEF4AA",
    "0B48C200ED9B9C2E06CCF0B4BF7879AA04A4F3C96A123C76B141014CF1CF3DB7",
    "102542507DD3EFD2985A8C1F32B693DB8BBDB68915DDFCDE0495319274CB805E",
    "179ECF51290F06D865C9A5F2B0E0C0D8538F1E0CD827AEEBC17A52243892961A",
    "095495252DF2A4B0436C4ED7475418D3DDBCEEEDEFA21C93F869D2EF7AF8D0E7",
    "0199F70BFEE188C09ADC670D87AB0FAF853A05009F4BF5F02CCC1118EBDDFD04",
    "2C4424651E6612AC440F1A0337C11AB8DE4E454B02E541F0D9FD94C71FE8894E",
    "1026A6B199FAF95F5D25039AA4AC197858EFCCC396D022EF2A91B6E8DAEFD401",
    "1592410F12E9ED7CB9A4E179545BB25E1CCD1FE651A357384C25C4069C91F447",
    "2EB2A6361DECCCD18AF7220BF07ACABA1AA2F72DF3C8987F2DE50550E2958EC1",
    "004E18672F832F967BC48680DEEA67CFAA5239523C8300431B3A5D6841C6C83A",
    "15D58A38461F1A3FF4FA48C05893549CCC347DE223C3DEFA6B62AD235F8F273C",
    "2F8B363CB00ED6B4C59CDCCDD8BC00C2B74A20692F50684554D26ADED7E536FE",
    "29723A5DCE93CCA5D1B5FA130CAA23DF1A0DC60D1B04A5AF92CEE4F9725C35C7",
    "2C54D95A6A6F7E09E4C3562ECF6D09641E29A72CC7A46E97555232044A6A8AAA",
    "2A62C847A7404E47D198158BC9783F57A7E9E936A512EBDB6ED07ED81040F9D1",
    "1276CFC056C55B3A9FEB8734289C38BB99F2D4ADB5DF85B9C6BAFF7F42489DDC",
    "27074FB9A068DA4DC423E47F968C2967012A8238C74008A2D3CFAE739A454417",
    "13B3CC235D66D3F0DB7862EE5B3E78A7AE3FBCB379571AF077693FA3A318BAF6",
    "1D4F5CBB8ED933063B61AFB45C92A6E42CB80BAAC351DDD75EFD8ADA23535E31",
    "2D4A0453F7E3632194D15444457F033B28822AC9E46AA9E8141EC98968666229",
    "0996408DB77890304CEC004CFF24E7031F20D91245BF698B8D85185BA4C6CA3C",
    "154C4433D7BC73B4BCBD880F933FD7AE87E618B381B3529BCFFC2281CBB1BA7F",
    "0DFE738C2DFA783EEB594ADF67C5E2B5581DE47F8C9CFA8A37FFFDE204EEB4FD",
    "009517FCAB532346F0C8B3DBCE4A6B24E901772BD3BFB55DD4F4CC1886BE22CB",
    "0E87F69B7BA84ABD34FB9822C91CC4053914904860EB136B5F24DC56C7EA4EF2",
    "20F6EBE7F3B318D178AF7FB4EBFE5E71B5D3380EE0CE07F275051F52FBCE3D50",
    "1F93934DC4DD378C4EF0C106DD721E55D59DB5910D92CC721DBD1B71E8B16AC9",
    "1C9601AF9F45092F62ED342E62CE154A3EE2583025F089235CED1AE2F1F84F9D",
    "04DD1E6797A385C12D4B7F911A28AC12149E3EBBE1AD536870725A7B494B13B0",
    "23E7A5D59830DB614D16A0ED4EEAEAEE5B793AA39AF8FF56AA7CA3BFEFCDEFBA",
    "12F8F2D6C41E9D384E01D138695ACFF6A73B557F5D2606E598CB0FFEC69F091D",
    "01376653F8BCF8FCEC5ED8C851453E6BDC678F31FC9C8B94453230E99068D2B7",
    "26B0BF23169407407B4C3B437D920B74C7BA13058818EDCBE4EED125540EEA78",
    "03A8A2797F6D8244E383F51FDC0EDC69873D81D75B6AC0B92643E4B02F67113D",
    "0758E495264CACE99ACEF218843149D62C2DE064A62936AD4161A862198B697F",
    "1973C04A42A8996D5F38671E71D3BE5778DE8BD4854259E8BB461FFC56399278",
    "2FF27DEBEB99ECE34CB68AD054C3725EB8EE3857DC97961896E1691A1E76A6E5",
    "1B2316EAB766BDA304543E47474AEF9CE91830A717686D5F74891D25EDA9E3D2",
    "29186C9E4543D1E838518A836CD160FEA11D0399D40D4A44248B5B86773454D3",
    "2FB5E09AAF4FB0F3E29D8037046242DFCFC25E0ACB6942D709F339C80D62156F",
    "2D026814A08DC4497C6E249DEBDF0BE4584D75FC1565DCCB36549687FCDCE5F7",
    "1F530540F99193B2535359650505DCDBABD5DAE0E7A25029EB427DA77DFD29D5",
    "059F1AD84CFAF236838C5DD78CF530E0F008631D7B911B108F9E9E35927A6A0C",
    "0F0CB8516E7358E13F8D29E3D7CA3B8772DA3F34C38DD54B79F32A64D3A173A9",
    "0A7B0E2F1FA2D3B05D30BA4010D38A04A413E0B31AEFD44A62CFD75BDEFAACB9",
    "29785CEE4A463F7C6A9D0FAF92B5D7835E2CF7ED758ECE279A896D3165F06E2A",
    "0550C951520A57C7EA1253CE4198F5151AAA801DA0C49B6B1599E1C4E9CD4A41",
    "0E4F3013A99A670D3B60456F721932B60627DAA3BE8AEDFE7E4D84D5528D5A94",
    "116159F5F5BE7755A0D02232FED8D99F2BCF672536C1373BCBDDC83CFE7FA461",
    "05F3B1526B9D0DCAEC2D707AC31E87E8699A46C852AC9EF94ABD5767DE5CFF47",
    "095E04894544E210764FF538802121E800B39970585063FE611136276AA16FE5",
    "2ADE487B239C12BB48FF17F278758DCA8DD1278972DAEF778F4C118DEC3DCF39",
    "053E3AA1ABA2476EDB26D2463332A0E186ED428ADEEE869D822401930F9E4128",
    "2DF9EB23269D857B49C76080928A62E518402EC26AEACE0C0D88790830E5E23F",
    "224883469ECBA978372E4E9412C3A434B7058D9D76F1D1869CA187BA7C1590D5",
    "0E0DBA4C312B41BB89EDCFF913835681A106D97EA723735220C2CD806F16968B",
    "2D9CE08F05FFC1ECED293BD9F8FB89D7BEF456B2B0FEC016E795C4159325337B",
    "162B649549C5ADC5F781E37B7DF61E7CE65F084B9825A23D9B6AA4BDC248E998",
    "2323A160C2346980DABF302E69E2CD88F307C1741DD583D36A06733F0A0936C8",
    "047D629034C42906BFF290342B2BAFA612F08B0F888FD5C5EA02384C639ADB87",
    "16749375AFAC68BB87291B6167AA55E389E69932DACACBF3762FEA925D7EE5C1",
    "14F633BA5F21231117F4D938BDBA1AD6587F37312DD852AE22E508B2557524F9",
    "2D02F2B341F65AD9D99E89CBA23A797806168EFEB2DA8169F7893783C9ACB782",
    "25F565E2EA7CB2FAFF221C35DEEC04B825960E1B26EDD936B39FD2C55A48BFFA",
    "0FEBD4FEF89C49B6B12C353E3EFB358203AEF5F13E2E25CDC88A9FAE17A48BA9",
    "11D001A9456099CD86C95CDEF6BFDA0434D6F52394944335CD6513BB41ADD7C3",
    "1CC2B66FCD7D66E5FF81955BED3CE8D976AAE481F100E40A5078171CFAD690B4",
    "16A755DC1AD34B4562A9D57DD375BA68BBE5424DF505A5DF3D1D1C16FC6F516E",
    "1C6D0E7F77D871F89F0324DAD2CF370292F81CD8D567129B56384EBE8F14B078",
    "278006A7FD3B154B9F25BE54A013734B0A5372FF88377C26EB219039558A281D",
    "22EB2867A539A9B6FF51D4A48B4CD8419252D07C0665D0BAF82ACF8AEF7DE8AD",
    "1A128B7188D4E3F1C22AA4BC4525BB26B50EBD80F50F267988BFE2E466E56A94",
    "1D2FAA5C28AA1D533513CBA89750B93CE71B4510C4C215EB1974A59051C5B093",
    "28EB1C41A050DC8AA3F9A8037CB81F575E5B1ACADC49E886E90BEE7F1A485149",
    "1E2586CBCA2364027AC96AD1490271B866E723385E96C9F720A72B1F67078E6E",
    "13C7E5C7724E33D7ACEC9E42FF8A4EE4F1AC8B6D0038F0FAF4908E74ED06C9BA",
    "09BF059AB4925C39C6DF84371572785D35E40BE573FDF1BE914FF6A87066923E",
    "1B7375F3920E121871CBC71E92A2F47518D26A20F236F9194A5C48F86DFABD38",
    "1494848F10672E535DE527D6D0591019987F6E11BA33B6F6EB73DC59289C2E36",
    "195378DCAFDEA646A00AE78D9E30487A41AA8B8864EF4035A751C3B8ECE36B0C",
    "0B6A5C76A2A2A0DB3843EF11176411388025F380E7A2D7EF1A6ACAFDA5899B0E",
    "0823E1D157F7C4712B4988AF4A0396EDB0950B1CCD001692E4EFF681E14C2FEF",
    "1633B048D2F14628309DBDF5A52736C0C5DE9BF96D7FB9D13A2CB4562074B222",
    "1F77DDD90F1EAB23737895EC06A295467086513DEC30B69738D226C82ED5E430",
    "09C71939B3672BF6AAAEBCF3717DAB67765D8B94726C19D76D57E7AEC751B94F",
    "048139270F0EF8F68D0B07C5D0005D7AD91D41FE306C8587BCF32D742CA1937D",
    "003ADFB1444CBF59321984D74E4434F3ED8A2F2376A41F5B9F52B1A6172C03E5",
    "2EEC4A7DE823BF9531D3F842E9A9C74B0D0C4F8B56A5A25EDE19B11F868B89CE",
    "0EA574B644B9F4CBA43338122827D08F07484A4CEB24AC9D00C4A668838900AF",
    "054DA055CD915CCA9A0DA4DD2CC86D99F08B287BBA925305ECC28ED0BDD28990",
    "02965A1D1F26FCD147AF96711976F84BC3F08A50E8B8C38F7E83E8638B8F4706",
    "1F97B34B9622F33893182C89F86EF052CE8E46A3BFE2E33FA2A34C5E051D91B8",
    "09A063B0B5EA468D93EDEECFC089699F815EDDBEB5E9369046740C7FEA6D1CB5",
    "1242820C24AFD7CC595F7A3DD0534C6CF1F00C6A84291C65417397C07D46B778",
    "2983C402AEC15B1D15F86A8D0378769832F0D5ED57AAB1D11CC08B4509512DA6",
    "136371A4B44FEBFFC233BD009BA8673764D2A73512E0EAB44024CB97134A3DD8",
    "2970729690BD8C8362BF5D0A76C215A03C26EF8A3E01EB91CB0E0C70EE25525E",
    "1C395CA2C5DB9B254B9B0EF75BA5C0961750F646F9A6A68D60E33CA2CE84427D",
    "02356C76528C4B9AE14F13F529206CCE462782256984DB7E1C3AAD5D6F367F68",
    "0C5A67378876463BDB3FF94D63E062ECEF7BD040316EAE92C8B035F693EC388E",
    "1B2AAFE5F720BFC99EF31B5E48B35DF72FCC920E66C3D90D86537AE35CE6BFF5",
    "067987B7638B9B082848F8EBA41EE203D3E90FC591407A4D87F81F088F9612A5",
    "148D4B0218744BCACCCEB62B6313A57272A1545FD75D1A8EBBD736E4276D5E6D",
    "043F8986CC56FCF8E88680A1E8F1C247165BCDB9A6CA2D94C7418D10AD8EF847",
    "1EF035D9FF4391C8001FBEC565A65CA3CD3B7D0823BB062A9141503A79731F81",
    "0A5162E6B35A320DEC11BA8639A1192F6A0A464F84DD3899C4DAB9D4EBBFE024",
    "2B5C89E9872AED76BAA36B83F87EB830FE16D34169F9EB1628E6FBEAA940CF3B",
    "0625C126499750374F2D3FD08940D1C0238FBD8DA85BDF47928188E3F9010627",
    "116BB85CFE6730C6448192438AF1748221D2BB302B3258350CBEBB1C5ECCD965",
    "11AA65A2B09DA598BB66377E54458C1DC4A7A3775F9C9CF51B2EBEA5C871ABFB",
    "280FBD8EB1CCC50603DBC78EB0BF9CB903CD9DF30F0F25F215AD4C3E1FB6BAF5",
    "0761A3E812087679E2748D24993AF14664667AA3D713796C79507F2A63F8ED76",
    "2BA668F10ABF878C8010155D539EB3CC30BB698F0062B1ED338C526FD12AC96D",
    "2F4E05914EF7C1B2EDF41C51266D3DC3E75C91B4C8DCEFEF873287120021CE0C",
    "29274BD37D7863D5EC7A82F28BCE6CF183FFFD4F8176AD07B158F1DF83C64804",
    "0C48FAD80901003D9B0DA5451971F8EEE03E4C394EC29DA5BF20A7BFAD98E41B",
    "16CF2CF2B9DA985924E713D6559192CA6128CCF71B4FC7C7EE0142D1C32F20D9",
    "00B7D9233273DE8B110605A3A7820C13CF7019BACF7E5882A85D5689F15C8CC1",
    "0F291F5AE7E99AABC73894608962DE3B6B76490754C0861DE32A58B1CDB86E18",
    "253406B596A33F5CF4B7E83F26116EB40D9707911B4290B2AF400D58D92CF210",
    "0812A4144D0D74BEAD1C5710D5239B640CCFC39FB66DAB8EAF7CB3160FE35861",
    "2D81A6DA9EEBC5D5D239D13B961BDEEBADCCE19F0625DE11A866BBCD0EF6F174",
    "1A22DAFAD979CAB2F645899290EB4DACCD04FEEF3155D88567324D23646F5064",
    "1BFF73AE8DCAEC7D09DB8CDAF9CA7A9A5D685A1665855B0FD4AB9C15289F181A",
    "0A16F8B0834ADA0C92B57E0F3E79E31F4BC6C4FBFE1E1C8A22CCE904C33EE709",
    "0CE7964C214C6389D581357E69009A141E16451DEF5E801D313BAD966D99548E",
    "2825C06BF975DFD5E8466BEE81947FC45B6A3E704DFE0350A04A9ED19293B3E0",
    "265917CF756C617609B958A33522FBAAD9BDEF1DFDE2DA8FC4D33B067058283F",
    "305A6987D779FBB9C92AAD8C64FD4398A501B347CF24D3AC0374379C3B988E0C",
    "19BA5A328C09BE61DF3216DB8CCFCA1392A45D45EF73C6D0BBDF798F52B0CAEA",
    "0569057F32180F19CF467121A3FF492228542300B440840EAD6ED63FF96FC92E",
    "300ADE0E02D409AA9CBD650C5018BF52C8AA6B46C3523664404942451CDFD7F3",
    "13E7AFC3E5B8AE05421D3101C6DCD069E9730F8B9A4D28B707919627D82ED576",
    "302CEBB80F47BC0D048B047E3EC4370A824D7741209189D6FAFB2E923C95F674",
    "0FEC1E8606F9C19F09F3F6CBCA8690F2A82C728121731C10B70A0A27425B7617",
    "01B36C8B38ABE36F31C85DFA0A4223C2127F9E70D6CB00ACCA7B4B820C42B4F8",
    "1AE800DFD62A6F893226EAF46ED30630BE2E658CA33BB2F8CB64A0EF6936167E",
    "043F80240127EBFDFE64478E6B490C262943C0891C090E4F9E5DA3A777397962",
    "284CC004329F4E38C3CA0E7B3148A180F6769757D97698A510F153ED07C0618B",
    "0A18CFEA20C4B70B9CFAFBD495E4FB978527DD3ADCBB2A1B51338F37B58EEF02",
    "1BC11B2F6ACC89E45BFC09641D1F50FE735ABFD0FE6B4485E134AFE45AD302A4",
    "27AF048A94639F26777E999118A6A53C031CC694291D09C52DC41CFBF548C07F",
    "226AB5B34D54C58D1B8FDFA18C3718E0ADB3382ACCC596EAAA90C06D43D6E8FD",
    "2434CC868807D7DC6385A67AB520F6908CD692288595B76156D7B1191D024617",
    "05F662504BC7E177EF21ED6B4D8EF9A3DCE1E82B88B2D48C35C0E23B405A15CF",
];

const MDS_MATRIX: &[&[&str]] = &[
    &[
        "2042DEF740CBC01BD03583CF0100E59370229ADAFBD0F5B62D414E62A0000001",
        "244B3AD628E5381F4A3C3448E1210245DE26EE365B4B146CF2E9782EF4000001",
        "135B52945A13D9AA49B9B57C33CD568BA9AE5CE9CA4A2D06E7F3FBD4C6666667",
    ],
    &[
        "244B3AD628E5381F4A3C3448E1210245DE26EE365B4B146CF2E9782EF4000001",
        "135B52945A13D9AA49B9B57C33CD568BA9AE5CE9CA4A2D06E7F3FBD4C6666667",
        "285396B510FEB022C442E4C2C1411EF84C2B4191BAC53323B891A1FB48000001",
    ],
    &[
        "135B52945A13D9AA49B9B57C33CD568BA9AE5CE9CA4A2D06E7F3FBD4C6666667",
        "285396B510FEB022C442E4C2C1411EF84C2B4191BAC53323B891A1FB48000001",
        "06E9C21069503B73AC9DC0D0EDEDE80D4EE2D80A5A8834A709B290CBFDB6DB6E",
    ],
];

pub type Bn254x3<CS> = PoseidonRef<CS, PlonkSpecRef, Bn254x3Generator, WIDTH>;

pub type Bn254x3Native = PoseidonRef<(), NativePlonkSpecRef<Fr>, Bn254x3Generator, WIDTH>;

#[derive(Debug)]
pub struct Bn254x3Generator;

impl FieldHasherGenerator<Rc<PoseidonConstants<Fr, WIDTH>>> for Bn254x3Generator {
    fn generate() -> Rc<PoseidonConstants<Fr, WIDTH>> {
        Rc::new(
            PoseidonConstants::from_constants(
                FULL_ROUNDS,
                PARTIAL_ROUNDS,
                parse_matrix(MDS_MATRIX).into(),
                parse_vec(ROUND_CONSTANTS),
            )
        )
    }
}
