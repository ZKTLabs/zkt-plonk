use ark_bn254::Fr;
use plonk_core::constraint_system::ConstraintSystem;
use plonk_hashing::hasher::{NativePlonkSpecRef, PlonkSpecRef, PoseidonConstants, PoseidonRef};

use crate::poseidon::{parse_matrix, parse_vec};

const FULL_ROUNDS: usize = 8;
const PARTIAL_ROUNDS: usize = 55;
const WIDTH: usize = 3;

const ROUND_CONSTANTS: &[&str] = &[
    "1946009D0964CFA93DCA70EC1C23E06268A9FA53F834021B4C43FABCF65F7B06",
    "13EBD94099E70CB14A2FB0FE09B69EAA3BAE7C627E32B3A4733906239F92D5F4",
    "18052ABB26580AE3C4D687D8E8EE2850ACFAEBF767C36904AC061D14CC3EC8AA",
    "1214830CFF0C5EC57BCD089B7F98A6721842896FAF20717E8F5326DF01A52D48",
    "2F5448EB6DFC0FE5C96FAFC641E61CAD0474DC71531B5BE7847BB6F97D32CC91",
    "1DB92B503BFE1A9098B04E2C15FD56B0AC5784DD6C9C27F93076627F48A72650",
    "17FCE3424EC7C85CEB9CFD1C39700D23AAE4E5AB1225C07C9982371DE9196A5D",
    "116D7EA8CE832B83947F086DBF7AE006C3B86DCED2625273627E4CC67B041197",
    "289E45B15AF33F1F296439E5AEE83AF0AC3910C11DA5A693A49C4E657AE3776C",
    "1B30E22047E1907AA347405C364BF2713DE86F7F1E6D7DB60C83658038B9272D",
    "15601091FCD006B67AA0A27F5AD4B861D786F0C1BBE415CAF53C2721C25B3FD9",
    "26E71974DF83CCCE9A35C8AE611F8F8E1B7C6A26398C90644FF93AD7A2327DD4",
    "0576A2A17486595CDB5BA102C5FE59B784A6E2811C47CE1FD35FADC314731552",
    "1C09C5EB338CA205512BFD5051D5205AEF14570FDE64A4DE57C97BC8F60D90F1",
    "04F789BD35A29AFD2CA830803C8B61792451F063CA785691590C14F604B7C593",
    "1A8DA453376D0BE46553321711F9B3246C35AE6CF405ECCEE1492DEA712639CF",
    "0EBCF547DCA61D0A2AFCBBDB1E3ADC0016CDDFF218AF2F466EC44017B75AC466",
    "20EE69847F3DB57BE85378613AFF0B7DB81F3365A3E661C21E11E73F9833C0B3",
    "0CB144E70470E7A6085DD2F3BC0430E9F1665B0AA8B4370080E1644090DBEA48",
    "1DC69EBD6E6401360DB1216B2C1A006BA303990CC5C0B97FE2C13FC3F7AECBB2",
    "2F8F4C11B92DC2E38AB11BECD3F93F8FE5AF19DC6913F105D26811EECA9B701D",
    "29ED685EE4F81CCEBBE56791985A80265DAC0F9F40DD3A81DC3239AF256F4150",
    "177E93C2A554A10A9091B112BB1A906165AE141D53D3A624853D19C6E6595845",
    "1221C22A68A94131EA141CA0937962B938943AF47910916F582740A90EEB7550",
    "04C83CD4DF53FF910A7394C2A8121D9CC18091ABF9A07933FF4AA46F8CD3333D",
    "1D73B5A8562A39F15104DE9B4D85220B71525B59BA05BD6D866D4D1ADFC4EBC6",
    "15D7934C07A6ABE8D2CAF0D337D8F83C3AC50DBBB8E17F4A13033E926CF25244",
    "18560E385DF5034CC20C9C4F6F35300C91B571064925F95A8C11C617D6AD95FC",
    "1D464851478DC5282FD62C97E195A914600E0B8A9A6D086B6A62165631C73A65",
    "0B6F5A07714D83DAD49C53373DBCFADAE9B90F25DEEC68DA2C0EDA41B76D7592",
    "1802DCF834575B1CD0270B92CAFD4D0498D1E8510EF5860F58B3B3ED585C81CC",
    "25F9137BAB983BE0222326392CC5DA773BB207C457AD6A40964F672F0BA4203A",
    "07603149C88EF3CA8BD7A86A364BA7CC81A575314A59703416BDF3EA46F85F6D",
    "18C9660BE7604E2AB1D5C21C6EF84467D1B88F9E7E1C0441CB1338AAD67FAE58",
    "26F3C8855EF14D8EA671721009AE9D4680929C3ADE2EFE4B181297F616AFE26C",
    "0ED6619CB6F7E13DEE54AC60A88BCDC3AF963C7C56C71C20FA1354C7F2BE5603",
    "18740C6B6E5FE0B9AFFD96152305FCDE8EFD4EEBD6BAD3F171EC232F33EEDC7E",
    "1D5D63E2034099410016BB1DFD03D714A85F9788CA2306FB4857DC8EFF4AB09D",
    "03EA1721D11FBF76DC0D1DE74A8092E2CFE0224095D3A27161CFECCD44FEB27C",
    "1D75C5F9E88C9C624CC45A77C8970C0DC7D626E09DDF28F85B735090EFD398FB",
    "22D2DCA48033E9E51C6A14FF79A27870EC953ECB9330D697612EC53392275915",
    "0A8C184114E709EAB3988C6C8BE804093CBD43B648A34DDFDC359ECBB9ED37DE",
    "1311190E30AD022A836CEF28A872332C7FE5E1C49A01C476EED21E27711DB3AE",
    "0B11C95F64864705153795C8DBC788FC5FE54BD136163963D23B45B287C6EB34",
    "1151D81BEF555CFDF45C8349FA6639E670DE18A6F264CD6877FFFC7EE2FFF785",
    "07846D79656383EDB3154DE0390D847B996A0622DC186BD2284DED00B1C3B004",
    "05629DBE6B98186002392FDD45046AEB29C520EEE05D66509D7CC10B7B7BEBC2",
    "16FAB776825CB641A80E80E714A360F9987D96A07108EF3A1DC5A4A1DF76FC77",
    "1A3A197D7FCF23BE4D1D57117461DD1B12F36BA86E67AC89D6D4C42C9B9857CF",
    "0CE1EACB6DDD8F6051AC41D2B618D444B9B28195F422C875A5E582FF2830BECE",
    "0906FC2A058127515BB4174D59CD01AEFB01C616E4275597EBE00FD5320A90F5",
    "0FC741C713EA5B10D557EA11E81C35692942F4217D014F00EB19F3F400E48B42",
    "16B892AC2AFA7866AAAC7579915F625546A178CDDCD798D51A158E06799E60A8",
    "24F346F600BE3BDB21647F1BE2E309A80635EDDD46A327AD4F8AF9CC6CC82562",
    "2D4C0BA4F48CCEB96CC692A313745AABBB1BD5E79B1F1691D49F18322BB4AAA6",
    "065404FACF49948B5FEE99C451B2102717DB2E565D2BB35A72486B8C31134DA0",
    "0933C1BDD4FA0AA5C32F05A19EABF90257624CE45220FB5B221F9B2E119FB74B",
    "2715E0C00B436647B3BC2D17FC2EFC4D5BF14B23D4BF97F9F3D32E8F39227B36",
    "0CC392EB45129D0EF88C037F7779A05FB5724DDC6F2AB5E021A7B2354E6FECC0",
    "21C988798073A00EE65340E811D877D2E1991C3E105CAAC5D990F003BF6EC7DE",
    "12D4375B8CEA961BD50336AB8C16E8EB0650D89E2269C880B2C8917CD82FF6A7",
    "2D7AF63E146E2A3630874A410E22EF609E32A6017347DF18D60EF01579360247",
    "0645B495828826B752E6C3DB6B9CB698C1949430E43C96B951DD6C8D57566DD3",
    "259DAD7475691694DD0E2CBAD9633375272D3DDFBE69F6528F7CE0CE3DEA565B",
    "21F5F79169ABF4ADB7398C923FF2501AA6F57570498B14BF5A91A6237353C25C",
    "10FE04395C05B8094DDEBA0D6BDE406A79BE746FD16221256F137DE2284A5652",
    "1ED8647C1CD31CBF2D14C4D76482178F68CC638EFB19236AF5B719D8FF9191FC",
    "23A196CEDD2252996B75A833285B5A0015DD29D22613C69E88F0BE44248C9228",
    "211EF7F10BD3FA681F6F561DBE57FCC33DC5194AA9061BA7253C2C5B39B58C73",
    "1E01ACA5525F8E70E980DA47CAF406AA95AF9994656606E5C07C36C0B260FB6C",
    "175FF1C10A6676AEF6250330341803A5C9278F2F0EC7FD4E7F75B0CE2D1A68A0",
    "026D0EC5AAA219137196C5FD8562CBCD8529264421C61A562B612267513FC467",
    "26B53DE39BD87981DB2F7DDD9263DE60CF930B92235BDC3E64E90307BAD523C4",
    "2B8460E4245556A1DBEFCF375FC6C601EBD5AEF0419F95ECA2CF5342D6A939B3",
    "2601A0C8B999E2D693A3BC663321513569567D243F5DA48E372AFBDB3B5E4B12",
    "182EA086C071D1C70120A5340DDAB42EA798D59F6E30474660FF8C9ECF7A06D7",
    "2EA818879304C37B23022DE5B478076F40CAEA04748DE013744F7A5C4391B183",
    "2620258AD487689A9FB589BCCD114193D45F51ADD14E2A32DCDBA079142FD73D",
    "2B9945570EDAB68BEA2300C19F62F8B780600ECF56326460D0F8FF08D735D13F",
    "28E87055BA786086F8DA8D8DAD9A4B47AC9D2CAE24AAC05576DFC6DF6A5D17F5",
    "26031ECB78A3172CA3213671F18641644E0F6643DC2DE8D2F0BBBE5FB07CC024",
    "2AE5E43D3C4AF5018FCFA8B514E76EEC596CC44C10CA8419ECA2680C4F9E0CED",
    "1DF6465282CA198801330E33307E554B5B27144399F56AA2B921A230DCAC966E",
    "214750173828406D4589AD81CE7FD872CCA82593CD3920907563A313A3268B64",
    "2C95CC545628E4ACD3BE84DE85EA6915EE2FAAC6ECA5C2669E90EF89555BECE6",
    "119A999F86F572F3FF3496FBE315F0E3AE8C74B77C1B421E44229F97B37EC0EB",
    "1E96EE76037A947A0C3FC22170308F9BC6F0A7F8F551401D085A9C5AE03D75AD",
    "26C58D88E9DD2AC80FD4CEA6A6F3946E52F98968F56682F605197903CDDF1CD2",
    "271C2818DE3E2CDBF52A513510C5DC8C316DFA4D7657346A6B8BCF15A74ECCB4",
    "2081F79386D79A3592FD67FC2598BAF53E2BF5678D697BF538F178207A60D1B8",
    "25B0778CE95B5A807AFA10B594D2952C0795F6200062F013388EC5AF557ACFAE",
    "212209E749D60723FD284D0CE89B80D0373A09E81D6E89DE82D7FF1A0CB4B147",
    "08C033583D8088D62A4E84F2E6E11C8AEC4935BA0812ED9CD6CE342F79A5DC1D",
    "1DD9AA2F85490BD3BF07AF203AE467858FB55445EEEE91BDDB7FDA5913DBE83F",
    "22C716A367B5CD76AB7AEFB766FA02FBCC8FECDF9B007CC4AE0B6237BF99C1BB",
    "01782C4671BFE74E327AC95B8CD1059ABF4F29F0F2D80DAB45932DF3BCA9404D",
    "195CFE61E7983F32C9547341D36A3F1C173833229C536C5B93BE6E435C5BAF6A",
    "1C21FAED092B9F8BC3792953F8D8A8D702618504E828D7674F7E87ACDCF9F287",
    "275CA33DFD9B2291F65FE40D3D72D9D8C1BBA4289880AC3810966EE4E84CF556",
    "0142E72DA7BDE6B4FA9635F787F4886B72D014630E0E9ADE514D3B969AE62782",
    "2345F9E32CF547DC2884527C793390BE242A8806A3FB65554245C97FA3564FE6",
    "2780FC54AF53742E515D5860354CCE35F69C5AEDC678DD03163345659AEE7C07",
    "3049364F3A0C0688B5D4006B1AEAB329FBBD5F0F28533FBC7F3D2F48075DE720",
    "02B52446ECB2F6A33F1D72773F55217146680025ABAD8C7910AF177FD86413F5",
    "292E262551F2D6F37969D8C2C01B6DDE59D96EDB04BCF15882E40C641962A32F",
    "076D599F9BC4B871C65D0DC51E48645CC79C185020631F0B17B376610D70C318",
    "2A28AD6D633A57DC4859C0E3A94F5A99B39DC5B79E3A6D3F9254E211A6019CE3",
    "2D8F31BC0D1D4C9FD48E84FF7F469DFDC2B0040A2DEADB3F3DAD79162BA50E92",
    "1B34AA585889DD724029140A517E9833AB41DFEFFAFB9875F2B4992F15822F46",
    "1DEE80C9109384344D535928501D84389F30FC01B38775D279B23D8036AB8979",
    "07DE27406CDBE69367FB2ACFFF9417AD61B77B7F39674CDA9960EF043FB61FEE",
    "13E91D47070B3D1342A626097ACE783C162FBD534C13754785853371F137CAA2",
    "027D60E4CE1B4315122154F4175FB93914374E91710F4748CC51B32D68B7E4D8",
    "2B870E482C96DC1DFE9A68F7E992FF966BD9F2B97739CF174FDB9373B1E5A88C",
    "28B82BF45EB321B79A0E739A9E0E9097F486D6A9B837E657EEF3EEE7102E77AA",
    "0A9AC4055A7DD60A815C6A3246EDF516C2BAD5530535D34C288096ADD0576087",
    "0B38AC7320210A436100FE9D0AF2B20775F0423136A9511EF6C501E772DE8719",
    "031BA46F50688009D6417CFFED720375C40EC88212002239BF0F96D3F8031D86",
    "0428DD2AD88E37AC45186CFF0456D2560031C6441E8818208A3C95CED7185B69",
    "16CC1BA84CE12F730DA63D7D095992D842A061869B3F810F85BEE461E0A9342B",
    "14DCE57CB65A82084FE8FCF0561E5263AEE3AA9F412515CF58EE8EECEDCCF974",
    "174FAB521BC98353E263AF832DBC9F2FC9CCB6AF8CC27BC54295F6B9E200CF94",
    "2C1FC8AC1AB56D15B0599B3A60D6A81BEB5B53E22835957EF492AC569BAB68BB",
    "0077C90F0B182E939C02514B4EEDEA63D9B1FD4734ECBB8ED86DEF2571FD467E",
    "2EBCDC4C6F9C8B60243F1B07228D2F5C5F2519E7C6E465380429B9D36E6F7B46",
    "0F2E97ED3932A5F72DB8D9B55B97D02148EEA5841C21B172B663E577D7F1F3CB",
    "0F1BEC4F62F2768AB74BA381B66CC9CD2619B5B9598E9B6ED250D215F529A873",
    "0FBEA77B21F4CDBE8A0FCA0F13C1DB60A00C248093F103DE430B48FE9AC1C898",
    "095DC312473240E17AA5F99904EE515EBEAE13FDCAA72282FFCD556A8369B218",
    "1DD840A3ABB7959DC5ED862355BE883A1D6A620C6E9354BC5FC400CED43230E1",
    "0B31E4A6F333AE3F4E7BFE9FC1B4F29CBB76DEDC53206CCA937FC1B9E6D8F774",
    "1DBD5667A990553F8FF8711900DD078C6F5163B7C7D7F98081C7849A6DFDA0A9",
    "1FC1424496A94C0007059DC43B5548AA764ABB09D855B56A4A0B4FA061CF1218",
    "2627BD3E375E4C0C361C5F9F179A1BB14BFC96BFBB671E9D3DA73956318CEDC1",
    "18195EF7A105C07E8D3DD6F37B01C3ECB78748AA664EDEA30FC56D765963E814",
    "2080A74CDF5216B8F764367DCC75AD227825EAD02D25E1C10891E66FF1A8AE7F",
    "237697BB318F9BE6D49B9DDFF0E70D915CAAC15EA2F59B18F88C670FAB768707",
    "2E9374673EC54F7D99AB364A5F4A1CA6B97A9EDB70E66E25CC7063A31C064AA4",
    "10109A9FF9F38C29B752F6BBF7C30458B227F05E350688C3DF4A50ECC2959B10",
    "15E2301DE26059A3A1F30632C0282BC9467CC6FD8AF208732FD512DB1C60CBFA",
    "0D98019FBE80E5E1EE6D07023F9CEEF286B8F19FB4B57CA8AF0032A8C4ADD5F3",
    "1B6931DB8D7D0F0AA7BC40DCCB99311BCB8951129DF19B8D3D4D3AC3FA33464E",
    "21B05E7DE33F12C713806EA148DD9AE7178EB89AAD11431AB81D1D7200457F23",
    "08F28884313C012814DA8716C50319C7FE9489020C4ABF9C21DC88A8AD1211F7",
    "00B8B9DE5F06159FF82DD22F428008CE43319DE1200290B8A4D4B43832FDA0E5",
    "078BE94412CF92E9CD3CE2B453E18605D7BA1DCA5B7B73E7CC68E8878AA3E89D",
    "2CE788482A6B9C4F815EF12F0431963D79818D3EC601F592584B05D7BD1E7F63",
    "1168732200523A2516D2AB4686FE9013DD0BC52EE5F2E268E3A69B61934B4CEA",
    "2EFCF57C69FBEFAC68ADDA5F0139B82CB3569472A027074DE2A8592C994487CF",
    "0E257F13FF48790ACE4D5FDF0E9D0EE4C5EC0848DF3739F61A62E859F6D5D000",
    "0778FABCA2D72922672748CAF13A9EBCB824E4FEE319E638FC4F8B165A359517",
    "16FE6388062FE13F4B31F556B55A1E333CF1A7E53DCE8A97269F6B7071BC07D7",
    "218642D547DCE508C18149304042897CB64D927B23A7993D8762ACEDD2050DE8",
    "1FC42FAB90C502417FB4D4A1A043E87C0840968F3F990382733095DB998777FB",
    "2D4DD5199DCFF94AF93D044E3C440F7DF3835CFDF4B7D6520BD0B275DCAFE929",
    "2C39A7B4864FECE6AD54BAF36D81571A585E8E0AB132D41A65774A9F5FA1DB8A",
    "1483F32BEFF6F7EEA3C10EB491674061103F63D428D7DCC31D5AA89A193B094B",
    "2E88C7B974F08A18E211369DB14C9704EAFC8E03D105279EDFEB6C62BF69801E",
    "1D3BB30794CEBE9B9233C2090FC4CCDB28CA737ACAE5516ADED0737645BF2F77",
    "077365AB4D352FDBE9DBB2B5E9E9D9CAAAE4C3248737BB7871789B1F2C8B7730",
    "176E655E3618C9AFA9BA0372CDA01CD311F6EAD5A3C6DFF695265F3D5BFC1120",
    "1C43CEB96C025E48F59A080A2717916EE6C979A65CC0917DC53E329AD666505B",
    "144076E592F5FE5BC15220165AB720003E6C526F40AEF062FF60BF4C0B90FA13",
    "0A31BEC66816BBF9B7205ECFA45A39C18CB6EF8772CFB55749A78A0645EF8DB7",
    "23DD5CBECAECCB12CBA89C212DA74ABF5E8108583318EB2458265A4A43386547",
    "21919DB12313E7B50665B2339C07AEE2F54ADB747A2F509305CC0DA558B42B29",
    "140F025ACD12F5061ABD1BF4A2B993EF389C9545528DCAFA694863EF47505258",
    "1FB09E9784C2C8B35FEB23BB0F2D07D5073A34B83224D24F2125F7EB93EA7BCC",
    "1433C92B4EE401EC0C0E133B50F200A2D8654F48F41D25393CB3FBF5BDA108E6",
    "160B48CDB8467DA91236DB893D31A38C86AB38E72775AF6463BF3604CAF0F07A",
    "278E4EB97316A00E00499C0ADA3D26077D80F4C6ED9E857A0613FA542733F3A3",
    "1D34226D4D4991D0008F3A744B87CBE81A9A6BE1EEC41B8D2BBA6EDB253F7CDD",
    "2F6F493E9532EF9BD9D2B97B43DE362C11300B2F4AE6205C1A5382201157A95C",
    "07912EC77A97704BEEBB9D060AD18D151F61C43973F78D1FEA45F9C1D10B3906",
    "2ADCF0DCCE15B5FE06C1C1D30C47F0DCA08A079FEE63FB03898ACF55C083178F",
    "0CB57C52E061D235677CD9C4657FB45A4F183B21A47154B17E44BB5BE1E0C066",
    "1A7C3FF3DB042F6EAE79D206939A149A9E0975B76E08EA7F9B8FD895D144B26C",
    "2DE6556011025FAD22A8190B30EEAE200358DCBB35E8976FBAB4724548CBF997",
    "1BDB0E41C5DE96CDCBDDDC66E13A9DA19D69A1F084F4108E76DE369426F0B5C2",
    "0DE39ACB905466DF0C303997F8861C72D63BFF83F839501F43BFCED77F77B06E",
    "2ED4F83E3995411055E7F2ECA2427A5B161A39B23AF404475D26DF5073E26584",
    "25A48BE0F36C87596A12D985B39B663E8E4023290F3DD6378002AA7EE2CF09EE",
    "0874C5B7653F62D3C2BDAEE6C5F0DBEB89DC68968383FD50540D667EB5E0D43F",
    "2A28B8F26B9C2101AB86618B8350DF6EB634FAF62BD858402192863CBFE30C79",
    "0D968898DB2FD3143C837155F18E4FEA4CB944AD8B5748F8076EA1CB661EEE3F",
    "0EEDAFF4BFB67089A03B9AE90E52E53B2055D5BD4C71E1D6CD46AE722E92824B",
    "10FE84EAA09D2C7425DCB4532F7AE83C4763C2C4A65034C3E827E6C7258C425A",
    "02D5CB46F0C50918238F1326178A1E69045DE47DFC960BAF20F3DE26CEBBD341",
    "007D550823E8C01458C810E5CE3C947EE384B3E6F8DBFBD42F53B53D53B2D876",
];

const MDS_MATRIX: &[&[&str]] = &[
    &[
        "14CF9766D3BDD51DB4EA4DB753538A2E75101F9F5DB369E8FAD2B89015555554",
        "0F9BB18D1ECE5FD647AFBA497E7EA7A2D7CC17B786468F6EBC1E0A6C0FFFFFFF",
        "162A3754AC156CB3C49CA2F8E57F3161B4ADA7D483C3EFA8D745397409999999",
    ],
    &[
        "0F9BB18D1ECE5FD647AFBA497E7EA7A2D7CC17B786468F6EBC1E0A6C0FFFFFFF",
        "162A3754AC156CB3C49CA2F8E57F3161B4ADA7D483C3EFA8D745397409999999",
        "0A67CBB369DEEA8EDA7526DBA9A9C5173A880FCFAED9B4F47D695C480AAAAAAA",
    ],
    &[
        "162A3754AC156CB3C49CA2F8E57F3161B4ADA7D483C3EFA8D745397409999999",
        "0A67CBB369DEEA8EDA7526DBA9A9C5173A880FCFAED9B4F47D695C480AAAAAAA",
        "02017ED283B7FB4FEA0FCE347EECC0E207DAEC5E847B8B05F41575289DB6DB6D",
    ],
];

pub type Bn254x3 = PoseidonRef<ConstraintSystem<Fr>, PlonkSpecRef, WIDTH>;

pub type Bn254x3Native = PoseidonRef<(), NativePlonkSpecRef<Fr>, WIDTH>;

pub fn bn254_x3_constants() -> PoseidonConstants<Fr> {
    PoseidonConstants::from_constants::<WIDTH>(
        FULL_ROUNDS,
        PARTIAL_ROUNDS,
        parse_matrix(MDS_MATRIX).unwrap().into(),
        parse_vec(ROUND_CONSTANTS).unwrap(),
    )
}
